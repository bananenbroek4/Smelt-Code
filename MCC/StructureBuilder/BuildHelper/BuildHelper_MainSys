> { "moduleStartX": 1, "moduleStartY": 0, "moduleStartZ": 1, "moduleStopX": 15, "moduleStopY": 15, "moduleStopZ": 2, "moduleBorder": 1 }

$clone_to_x=		25
$clone_to_z=		-9
$clone_from_x=	25
$clone_from_z=	-9

$aecDuration=200


/*
 structure_scanner = SS
 template_scanner = TS

*/

# starting condition
>{"type":"repeating-chain","auto":true}
	/execute @e[name=x_TS] ~ ~ ~ /execute @e[name=x_spawnstructure] ~ ~ ~ /setblock ~ ~ ~ air
	/execute @e[name=x_TS] ~ ~ ~ /kill @e[name=x_spawnstructure]
	/testfor @e[name=x_template,type=armor_stand]
>{"conditional":true}
	/testfor @e[name=x_spawnstructure,type=armor_stand,tag=!x_transferstructure]
	/scoreboard players tag @e[name=x_spawnstructure,type=armor_stand,tag=!x_transferstructure] add x_transferstructure
	/testfor @e[name=x_spawnstructure,tag=!x_transferredstructure]
	!start_event+ x_initiatetransfer
	/scoreboard players tag @e[name=x_spawnstructure,tag=x_transferstructure] add x_transferredstructure
>{"conditional":false}
	/scoreboard players tag @e[name=x_template] remove x_onAir
	/execute @e[name=x_template] ~ ~ ~ detect ~ ~-1 ~ air * /scoreboard players tag @e[dx=0,name=x_template] add x_onAir
	/kill @e[name=x_template,type=armor_stand,tag=x_onAir]
	/kill @e[name=x_spawnstructure,tag=!x_transferstructure]

>{"type":"impulse-chain","conditional":false}
!event+ x_initiatetransfer
	/execute @e[name=x_spawnstructure] ~ ~ ~ /fill ~ ~ ~ ~ ~ ~ air 0 replace command_block *

	/scoreboard objectives add x_samematerial dummy

	/scoreboard players set @e[name=x_template] x_samematerial 0
	/execute @e[name=x_spawnstructure] ~ ~-1 ~ /clone ~ ~ ~ ~ ~ ~ $clone_to_x 0 $clone_to_z
	/stats entity @e[name=x_template,type=armor_stand] set SuccessCount @e[c=1,name=x_template,type=armor_stand] x_samematerial
	/execute @e[name=x_template] ~ ~-1 ~ /testforblocks ~ ~ ~ ~ ~ ~ $clone_to_x 0 $clone_to_z
	/stats entity @e[name=x_template] clear SuccessCount
	/scoreboard players tag @e[name=x_template] remove x_samematerial
	/execute @e[name=x_template,score_x_samematerial_min=1] ~ ~ ~ detect ~ ~-2 ~ lever powered=true /scoreboard players tag @e[name=x_template,c=1,r=0] add x_samematerial
	/testfor @e[name=x_template,tag=x_samematerial]
	!invertresult
		>{"conditional":true}
			/execute @e[name=x_spawnstructure] ~ ~ ~ /title @p actionbar [{"text":"ERROR - No valid template found: you might be using the wrong filter, or the templates may not be enabled!","color":"gold"}]
			/execute @e[name=x_spawnstructure] ~ ~ ~ /playsound block.note.bass master @p
		>{"conditional":false}

	//scoreboard objectives remove x_samematerial

	/execute @r[type=armor_stand,name=x_template,tag=x_samematerial] ~ ~ ~ /summon area_effect_cloud ~ ~ ~ {CustomName:"x_TS",Small:1,Marker:1,NoGravity:1,Tags:["x_new","x_spwnscan","x_lastcycle"],Duration:$aecDuration}
	/execute @e[name=x_TS] ~ ~ ~ /execute @e[name=x_spawnstructure] ~ ~ ~ /summon area_effect_cloud ~ ~ ~ {CustomName:"x_SS",Small:1,Marker:1,NoGravity:1,Tags:["x_new"],Duration:$aecDuration}
	/kill @e[name=x_spawnstructure]
	//scoreboard players tag @e[name=x_spawnstructure,tag=x_transferstructure] add x_transferredstructure
	
>{"executeAs":"@e[name=x_TS]"}
	/scoreboard objectives add x_x dummy
	/scoreboard objectives add x_xholder dummy
	/scoreboard objectives add x_z dummy
	/scoreboard objectives add x_zholder dummy
	/scoreboard objectives add x_xs dummy
	/scoreboard objectives add x_zs dummy
>{"executeAs":""}

	/scoreboard players set @e[type=area_effect_cloud,tag=x_new] x_x 0
	/scoreboard players set @e[type=area_effect_cloud,tag=x_new] x_z 0

	/summon area_effect_cloud ~ ~ ~ {CustomName:"x_0",Tags:["x_rotation"],Duration:1}
	/summon area_effect_cloud ~ ~ ~ {CustomName:"x_90",Tags:["x_rotation"],Duration:1}
	/summon area_effect_cloud ~ ~ ~ {CustomName:"x_180",Tags:["x_rotation"],Duration:1}
	/summon area_effect_cloud ~ ~ ~ {CustomName:"x_270",Tags:["x_rotation"],Duration:1}
	/scoreboard players tag @e[name=Loop_x_expand] remove x_0
	/scoreboard players tag @e[name=Loop_x_expand] remove x_90
	/scoreboard players tag @e[name=Loop_x_expand] remove x_180
	/scoreboard players tag @e[name=Loop_x_expand] remove x_270
	/scoreboard players tag @r[type=area_effect_cloud,tag=x_rotation] add x_chooserot
	/execute @e[name=x_0,tag=x_chooserot] ~ ~ ~ /scoreboard players tag @e[name=Loop_x_expand] add x_0
	/execute @e[name=x_90,tag=x_chooserot] ~ ~ ~ /scoreboard players tag @e[name=Loop_x_expand] add x_90
	/execute @e[name=x_180,tag=x_chooserot] ~ ~ ~ /scoreboard players tag @e[name=Loop_x_expand] add x_180
	/execute @e[name=x_270,tag=x_chooserot] ~ ~ ~ /scoreboard players tag @e[name=Loop_x_expand] add x_270

	//scoreboard players set -1 x_const -1

	!start_loop+ x_expand